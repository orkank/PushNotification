<?php
/** @var \IDangerous\PushNotification\Block\Adminhtml\Notification\Multiple $block */
?>
<meta charset="utf-8">
<div class="page-main-actions">
    <div class="page-actions">
        <div class="page-actions-buttons">
            <button type="button" class="action-primary" id="send-notification">
                <span><?= $block->escapeHtml(__('Send Notification')) ?></span>
            </button>
        </div>
    </div>
</div>

<div class="admin__page-section">
    <div class="admin__page-section-title">
        <span class="title"><?= $block->escapeHtml(__('Send Multiple Notifications')) ?></span>
    </div>
    <div class="admin__page-section-content">
        <div class="admin__page-section-item admin__page-section-item-content">
            <form id="multiple-notification-form" method="post" action="<?= $block->escapeUrl($block->getSendUrl()) ?>" class="admin__page-section" accept-charset="utf-8">
                <input name="form_key" type="hidden" value="<?= $block->escapeHtmlAttr($block->getFormKey()) ?>">
                <div class="admin__field-set admin__field-set-group">
                    <div class="admin__fieldset">
                        <div class="admin__field admin__field-option _required">
                            <label class="admin__field-label" for="title">
                                <span><?= $block->escapeHtml(__('Title')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="text" name="title" id="title" class="admin__control-text required-entry" maxlength="255">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option _required">
                            <label class="admin__field-label" for="message">
                                <span><?= $block->escapeHtml(__('Message')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <textarea name="message" id="message" class="admin__control-textarea required-entry" rows="4"></textarea>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="image_url">
                                <span><?= $block->escapeHtml(__('Image URL (Optional)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="url" name="image_url" id="image_url" class="admin__control-text" maxlength="500">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="action_url">
                                <span><?= $block->escapeHtml(__('Action URL (Optional)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="url" name="action_url" id="action_url" class="admin__control-text" maxlength="500">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="notification_type">
                                <span><?= $block->escapeHtml(__('Notification Type')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="notification_type" id="notification_type" class="admin__control-select">
                                    <option value="general"><?= $block->escapeHtml(__('General')) ?></option>
                                    <option value="promotion"><?= $block->escapeHtml(__('Promotion')) ?></option>
                                    <option value="order"><?= $block->escapeHtml(__('Order')) ?></option>
                                    <option value="news"><?= $block->escapeHtml(__('News')) ?></option>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="silent">
                                <span><?= $block->escapeHtml(__('Silent (no sound)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="checkbox" name="silent" id="silent" value="1">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="badge">
                                <span><?= $block->escapeHtml(__('Badge (Optional)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="number" name="badge" id="badge" class="admin__control-text" min="0" step="1" placeholder="<?= $block->escapeHtmlAttr(__('e.g. 1')) ?>">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="scheduled_at">
                                <span><?= $block->escapeHtml(__('Schedule Send Time (Optional)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="datetime-local" name="scheduled_at" id="scheduled_at" class="admin__control-text">
                                <p class="note"><?= $block->escapeHtml(__('Leave empty to send immediately. Format: YYYY-MM-DD HH:MM')) ?></p>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="user_type">
                                <span><?= $block->escapeHtml(__('User Type')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="user_type" id="user_type" class="admin__control-select">
                                    <option value="all"><?= $block->escapeHtml(__('All Users')) ?></option>
                                    <option value="member"><?= $block->escapeHtml(__('Member Users Only')) ?></option>
                                    <option value="guest"><?= $block->escapeHtml(__('Guest Users Only')) ?></option>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="device_type">
                                <span><?= $block->escapeHtml(__('Device Type')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="device_type" id="device_type" class="admin__control-select">
                                    <option value=""><?= $block->escapeHtml(__('All Devices')) ?></option>
                                    <option value="ios"><?= $block->escapeHtml(__('iOS Only')) ?></option>
                                    <option value="android"><?= $block->escapeHtml(__('Android Only')) ?></option>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="customer_group">
                                <span><?= $block->escapeHtml(__('Customer Group')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="customer_group" id="customer_group" class="admin__control-select">
                                    <option value=""><?= $block->escapeHtml(__('All Groups')) ?></option>
                                    <?php foreach ($block->getCustomerGroups() as $group): ?>
                                        <option value="<?= $block->escapeHtmlAttr($group->getId()) ?>">
                                            <?= $block->escapeHtml($group->getCustomerGroupCode()) ?>
                                        </option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="last_seen_from">
                                <span><?= $block->escapeHtml(__('Last Seen From')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="date" name="last_seen_from" id="last_seen_from" class="admin__control-text">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="last_seen_to">
                                <span><?= $block->escapeHtml(__('Last Seen To')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <input type="date" name="last_seen_to" id="last_seen_to" class="admin__control-text">
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="order_quantity">
                                <span><?= $block->escapeHtml(__('Order Quantity')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="order_quantity" id="order_quantity" class="admin__control-select">
                                    <option value=""><?= $block->escapeHtml(__('All Orders')) ?></option>
                                    <option value="0"><?= $block->escapeHtml(__('0 Orders (New Customers)')) ?></option>
                                    <option value="1"><?= $block->escapeHtml(__('1 Order')) ?></option>
                                    <option value="2"><?= $block->escapeHtml(__('2 Orders')) ?></option>
                                    <option value="3"><?= $block->escapeHtml(__('3 Orders')) ?></option>
                                    <option value="4-10"><?= $block->escapeHtml(__('4-10 Orders')) ?></option>
                                    <option value="11-50"><?= $block->escapeHtml(__('11-50 Orders')) ?></option>
                                    <option value="51+"><?= $block->escapeHtml(__('51+ Orders (VIP)')) ?></option>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option">
                            <label class="admin__field-label" for="custom_data_type">
                                <span><?= $block->escapeHtml(__('Custom Data (Optional)')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <select name="custom_data_type" id="custom_data_type" class="admin__control-select">
                                    <option value=""><?= $block->escapeHtml(__('No Custom Data')) ?></option>
                                    <option value="raw"><?= $block->escapeHtml(__('Raw JSON')) ?></option>
                                    <option value="keyvalue"><?= $block->escapeHtml(__('Key-Value Pairs')) ?></option>
                                </select>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option" id="custom_data_raw_container" style="display: none;">
                            <label class="admin__field-label" for="custom_data_raw">
                                <span><?= $block->escapeHtml(__('Raw JSON Data')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <textarea name="custom_data_raw" id="custom_data_raw" class="admin__control-textarea" rows="4" placeholder='{"key": "value", "number": 123}'></textarea>
                                <div class="admin__field-note">
                                    <span><?= $block->escapeHtml(__('Enter valid JSON format. All values will be converted to strings.')) ?></span>
                                </div>
                            </div>
                        </div>

                        <div class="admin__field admin__field-option" id="custom_data_keyvalue_container" style="display: none;">
                            <label class="admin__field-label">
                                <span><?= $block->escapeHtml(__('Key-Value Pairs')) ?></span>
                            </label>
                            <div class="admin__field-control">
                                <div id="keyvalue_pairs">
                                    <div class="keyvalue-pair">
                                        <input type="text" name="custom_data_keys[]" class="admin__control-text" placeholder="<?= $block->escapeHtmlAttr(__('Key')) ?>" style="width: 45%; margin-right: 10px;">
                                        <input type="text" name="custom_data_values[]" class="admin__control-text" placeholder="<?= $block->escapeHtmlAttr(__('Value')) ?>" style="width: 45%;">
                                        <button type="button" class="action-remove" style="margin-left: 10px;"><?= $block->escapeHtml(__('Remove')) ?></button>
                                    </div>
                                </div>
                                <button type="button" id="add_keyvalue_pair" class="action-secondary" style="margin-top: 10px;">
                                    <?= $block->escapeHtml(__('Add Key-Value Pair')) ?>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/x-magento-init">
{
    "*": {
        "IDangerous_PushNotification/js/multiple-notification": {}
    }
}
</script>




